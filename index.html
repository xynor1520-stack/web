<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvoiceFlow - Sistema de Facturaci√≥n Profesional</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}:root{--primary:#4f46e5;--primary-dark:#4338ca;--secondary:#10b981;--danger:#ef4444;--warning:#f59e0b;--dark:#1f2937;--darker:#111827;--light:#f9fafb;--border:#e5e7eb;--text:#374151;--text-light:#6b7280}body{font-family:'Inter',sans-serif;background:var(--light);color:var(--text);transition:all .3s ease}body.dark-mode{--light:#111827;--dark:#f9fafb;--darker:#1f2937;--border:#374151;--text:#e5e7eb;--text-light:#9ca3af;background:#0f172a}.login-container{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);padding:20px}.login-box{background:white;padding:50px 40px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);width:100%;max-width:450px;animation:slideUp .5s ease}body.dark-mode .login-box{background:var(--darker)}@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.login-logo{text-align:center;margin-bottom:40px}.login-logo h1{font-size:2em;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}.login-logo p{color:var(--text-light);font-size:.95em}.role-selector{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:30px}.role-btn{padding:15px;border:2px solid var(--border);background:white;border-radius:12px;cursor:pointer;transition:all .3s ease;text-align:center;font-weight:600;color:var(--text)}body.dark-mode .role-btn{background:var(--darker);border-color:var(--border)}.role-btn:hover{border-color:var(--primary);transform:translateY(-2px)}.role-btn.active{background:var(--primary);color:white;border-color:var(--primary)}.role-btn .icon{font-size:1.5em;display:block;margin-bottom:5px}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:8px;font-weight:600;color:var(--text)}.form-group input,.form-group select,.form-group textarea{width:100%;padding:15px;border:2px solid var(--border);border-radius:10px;font-size:1em;transition:all .3s ease;background:white;color:var(--text);font-family:'Inter',sans-serif}body.dark-mode .form-group input,body.dark-mode .form-group select,body.dark-mode .form-group textarea{background:var(--darker);border-color:var(--border)}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(79,70,229,.1)}.btn-primary{width:100%;padding:15px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;border:none;border-radius:10px;font-size:1.1em;font-weight:600;cursor:pointer;transition:all .3s ease}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(79,70,229,.4)}.dashboard{display:none;min-height:100vh}.dashboard.active{display:flex}.sidebar{width:280px;background:white;border-right:1px solid var(--border);padding:30px 0;position:fixed;height:100vh;overflow-y:auto;transition:all .3s ease;z-index:100}body.dark-mode .sidebar{background:var(--darker)}.sidebar-header{padding:0 30px 30px;border-bottom:1px solid var(--border)}.sidebar-logo{font-size:1.5em;font-weight:700;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:5px}.user-role{font-size:.85em;color:var(--text-light);font-weight:500}.sidebar-menu{padding:20px 0}.menu-item{padding:15px 30px;display:flex;align-items:center;gap:15px;color:var(--text);cursor:pointer;transition:all .3s ease;font-weight:500;border-left:4px solid transparent}.menu-item:hover{background:var(--light);border-left-color:var(--primary)}body.dark-mode .menu-item:hover{background:rgba(79,70,229,.1)}.menu-item.active{background:rgba(79,70,229,.1);color:var(--primary);border-left-color:var(--primary)}.menu-item .icon{font-size:1.3em}.main-content{margin-left:280px;padding:30px;flex:1;transition:all .3s ease}.top-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;background:white;padding:20px 30px;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,.05)}body.dark-mode .top-bar{background:var(--darker)}.search-bar{flex:1;max-width:500px;position:relative}.search-bar input{width:100%;padding:12px 45px 12px 20px;border:2px solid var(--border);border-radius:10px;font-size:.95em;background:var(--light);color:var(--text)}body.dark-mode .search-bar input{background:#0f172a}.search-bar .icon{position:absolute;right:15px;top:50%;transform:translateY(-50%);color:var(--text-light)}.top-actions{display:flex;gap:15px;align-items:center}.icon-btn{width:45px;height:45px;border-radius:10px;background:var(--light);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.2em;transition:all .3s ease;color:var(--text)}body.dark-mode .icon-btn{background:#0f172a}.icon-btn:hover{background:var(--primary);color:white}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}.stat-card{background:white;padding:25px;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,.05);transition:all .3s ease;position:relative;overflow:hidden}body.dark-mode .stat-card{background:var(--darker)}.stat-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,.1)}.stat-card::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--primary)}.stat-card.success::before{background:var(--secondary)}.stat-card.warning::before{background:var(--warning)}.stat-card.danger::before{background:var(--danger)}.stat-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.stat-icon{width:50px;height:50px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5em}.stat-card .stat-icon{background:rgba(79,70,229,.1);color:var(--primary)}.stat-card.success .stat-icon{background:rgba(16,185,129,.1);color:var(--secondary)}.stat-card.warning .stat-icon{background:rgba(245,158,11,.1);color:var(--warning)}.stat-card.danger .stat-icon{background:rgba(239,68,68,.1);color:var(--danger)}.stat-value{font-size:2em;font-weight:700;color:var(--text);margin-bottom:5px}.stat-label{color:var(--text-light);font-size:.95em}.charts-grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-bottom:30px}.chart-card{background:white;padding:25px;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,.05)}body.dark-mode .chart-card{background:var(--darker)}.chart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.chart-title{font-size:1.2em;font-weight:600;color:var(--text)}.table-card{background:white;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,.05);overflow:hidden}body.dark-mode .table-card{background:var(--darker)}.table-header{padding:25px 30px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px}.table-title{font-size:1.2em;font-weight:600;color:var(--text)}.table-filters{display:flex;gap:10px;flex-wrap:wrap}.filter-btn{padding:10px 20px;border:2px solid var(--border);background:var(--light);border-radius:8px;cursor:pointer;font-weight:500;transition:all .3s ease;color:var(--text)}body.dark-mode .filter-btn{background:#0f172a}.filter-btn.active{background:var(--primary);color:white;border-color:var(--primary)}table{width:100%;border-collapse:collapse}thead{background:var(--light)}body.dark-mode thead{background:#0f172a}th{padding:15px 30px;text-align:left;font-weight:600;color:var(--text);font-size:.9em}td{padding:20px 30px;border-top:1px solid var(--border);color:var(--text)}.status-badge{padding:6px 12px;border-radius:20px;font-size:.85em;font-weight:600;display:inline-block}.status-paid{background:rgba(16,185,129,.1);color:var(--secondary)}.status-pending{background:rgba(245,158,11,.1);color:var(--warning)}.status-overdue{background:rgba(239,68,68,.1);color:var(--danger)}.action-btns{display:flex;gap:8px}.btn-action{padding:8px 12px;border:none;border-radius:6px;cursor:pointer;font-size:.9em;transition:all .3s ease}.btn-view{background:rgba(79,70,229,.1);color:var(--primary)}.btn-edit{background:rgba(16,185,129,.1);color:var(--secondary)}.btn-delete{background:rgba(239,68,68,.1);color:var(--danger)}.btn-action:hover{transform:translateY(-2px)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center;padding:20px}.modal.active{display:flex;animation:fadeIn .3s ease}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.modal-content{background:white;border-radius:15px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;animation:slideUp .3s ease}body.dark-mode .modal-content{background:var(--darker)}.modal-header{padding:25px 30px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.modal-title{font-size:1.5em;font-weight:600;color:var(--text)}.modal-close{width:40px;height:40px;border-radius:8px;background:var(--light);border:none;cursor:pointer;font-size:1.5em;display:flex;align-items:center;justify-content:center;transition:all .3s ease}body.dark-mode .modal-close{background:#0f172a}.modal-close:hover{background:var(--danger);color:white}.modal-body{padding:30px}.form-row{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-bottom:20px}.btn-secondary{padding:12px 30px;border:2px solid var(--border);background:white;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s ease;color:var(--text)}body.dark-mode .btn-secondary{background:var(--darker)}.btn-secondary:hover{border-color:var(--primary);color:var(--primary)}.toast{position:fixed;top:20px;right:20px;background:white;padding:20px 25px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.2);z-index:2000;display:flex;align-items:center;gap:15px;transform:translateX(400px);transition:all .3s ease}body.dark-mode .toast{background:var(--darker)}.toast.show{transform:translateX(0)}.toast-icon{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.2em}.toast.success .toast-icon{background:rgba(16,185,129,.1);color:var(--secondary)}.toast.error .toast-icon{background:rgba(239,68,68,.1);color:var(--danger)}.toast-message{font-weight:500;color:var(--text)}.loader{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:3000;align-items:center;justify-content:center}.loader.active{display:flex}.loader-spinner{width:60px;height:60px;border:4px solid rgba(255,255,255,.3);border-top-color:white;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}@media(max-width:768px){.sidebar{transform:translateX(-100%)}.sidebar.mobile-open{transform:translateX(0)}.main-content{margin-left:0}.charts-grid{grid-template-columns:1fr}.stats-grid{grid-template-columns:1fr}.form-row{grid-template-columns:1fr}.table-filters{flex-direction:column;width:100%}.filter-btn{width:100%}table{font-size:.85em}th,td{padding:12px 15px}.top-bar{flex-direction:column;gap:15px}.search-bar{max-width:100%}}.hidden{display:none!important}
    </style>
</head>
<body>
    <div id="login-page" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <h1>üíº InvoiceFlow</h1>
                <p>Sistema Profesional de Facturaci√≥n</p>
            </div>
            <div class="role-selector">
                <button class="role-btn active" data-role="admin">
                    <span class="icon">üëë</span> Admin
                </button>
                <button class="role-btn" data-role="empleado">
                    <span class="icon">üëî</span> Empleado
                </button>
                <button class="role-btn" data-role="cliente">
                    <span class="icon">üë§</span> Cliente
                </button>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label>Usuario</label>
                    <input type="text" id="username" placeholder="admin / empleado / cliente" required value="admin">
                </div>
                <div class="form-group">
                    <label>Contrase√±a</label>
                    <input type="password" id="password" placeholder="123456" required value="123456">
                </div>
                <button type="submit" class="btn-primary">Iniciar Sesi√≥n</button>
            </form>
            <p style="text-align:center;margin-top:20px;color:var(--text-light);font-size:0.9em;">
                üí° Selecciona rol ‚Üí usuario = rol ‚Üí contrase√±a = 123456
            </p>
        </div>
    </div>

    <div id="dashboard" class="dashboard">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üíº InvoiceFlow</div>
                <div class="user-role" id="user-role-display">Admin</div>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <span class="icon">üìä</span><span>Dashboard</span>
                </div>
                <div class="menu-item" data-page="invoices">
                    <span class="icon">üìÑ</span><span>Facturas</span>
                </div>
                <div class="menu-item admin-only" data-page="clients">
                    <span class="icon">üë•</span><span>Clientes</span>
                </div>
                <div class="menu-item admin-only" data-page="reports">
                    <span class="icon">üìà</span><span>Reportes</span>
                </div>
                <div class="menu-item" data-page="settings">
                    <span class="icon">‚öôÔ∏è</span><span>Configuraci√≥n</span>
                </div>
                <div class="menu-item" onclick="logout()">
                    <span class="icon">üö™</span><span>Cerrar Sesi√≥n</span>
                </div>
            </nav>
        </aside>
        <main class="main-content">
            <div class="top-bar">
                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="B√∫squeda avanzada: cliente:ABC, estado:paid, monto>1000, fecha:2024-12">
                    <span class="icon">üîç</span>
                </div>
                <div class="top-actions">
                    <button class="icon-btn" onclick="toggleDarkMode()" title="Modo oscuro">üåô</button>
                    <button class="icon-btn" onclick="showNotifications()" title="Notificaciones">üîî</button>
                    <button class="icon-btn" onclick="openNewInvoiceModal()" title="Nueva factura">‚ûï</button>
                </div>
            </div>
            <div id="dashboard-content"></div>
        </main>
    </div>

    <div id="invoice-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nueva Factura</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="invoice-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Cliente</label>
                            <input type="text" id="invoice-client" placeholder="Nombre del cliente" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha</label>
                            <input type="date" id="invoice-date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Monto</label>
                            <input type="number" id="invoice-amount" placeholder="0.00" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Estado</label>
                            <select id="invoice-status" required>
                                <option value="pending">Pendiente</option>
                                <option value="paid">Pagada</option>
                                <option value="overdue">Vencida</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descripci√≥n</label>
                        <textarea id="invoice-description" rows="4" placeholder="Descripci√≥n de los servicios..."></textarea>
                    </div>
                    <div style="display:flex;gap:15px;justify-content:flex-end;margin-top:30px;">
                        <button type="button" class="btn-secondary" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn-primary" style="width:auto;padding:12px 30px;">Crear Factura</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="loader" class="loader">
        <div class="loader-spinner"></div>
    </div>

    <div id="toast" class="toast">
        <div class="toast-icon">‚úì</div>
        <div class="toast-message">Operaci√≥n exitosa</div>
    </div>
        <script>
        let currentUser = null;
        let invoices = [];
        let currentFilter = 'all';

        document.addEventListener('DOMContentLoaded', function() {
            loadSampleData();
            setupEventListeners();
            document.getElementById('invoice-date').valueAsDate = new Date();
        });

        function loadSampleData() {
            invoices = [
                { id: 'INV-001', client: 'Empresa ABC S.A.', date: '2024-12-15', amount: 1500.00, status: 'paid', description: 'Desarrollo web completo' },
                { id: 'INV-002', client: 'Tech Solutions', date: '2024-12-14', amount: 2300.00, status: 'pending', description: 'Consultor√≠a IT y soporte' },
                { id: 'INV-003', client: 'Marketing Pro', date: '2024-12-10', amount: 890.00, status: 'paid', description: 'Dise√±o gr√°fico y branding' },
                { id: 'INV-004', client: 'Retail Global', date: '2024-11-30', amount: 3200.00, status: 'overdue', description: 'Sistema POS personalizado' },
                { id: 'INV-005', client: 'Construcciones Modernas', date: '2024-12-12', amount: 1750.00, status: 'pending', description: 'Aplicaci√≥n m√≥vil Android/iOS' },
                { id: 'INV-006', client: 'Alimentos Gourmet', date: '2024-12-08', amount: 950.00, status: 'paid', description: 'P√°gina web e-commerce' },
                { id: 'INV-007', client: 'Servicios M√©dicos Plus', date: '2024-12-05', amount: 2100.00, status: 'pending', description: 'Sistema de gesti√≥n de pacientes' },
            ];
        }

        function setupEventListeners() {
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            document.querySelectorAll('.menu-item[data-page]').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.dataset.page;
                    showPage(page);
                });
            });
            document.getElementById('invoice-form').addEventListener('submit', handleNewInvoice);
            document.getElementById('search-input').addEventListener('input', handleSearch);
        }

        function showPage(page) {
            const content = document.getElementById('dashboard-content');
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            const activeItem = document.querySelector(`.menu-item[data-page="${page}"]`);
            if (activeItem) activeItem.classList.add('active');

            let html = '';

            if (page === 'dashboard') {
                html = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="total-facturado">$0</div>
                                    <div class="stat-label">Total Facturado (Mes)</div>
                                </div>
                                <div class="stat-icon">üí∞</div>
                            </div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="facturas-pagadas">0</div>
                                    <div class="stat-label">Facturas Pagadas</div>
                                </div>
                                <div class="stat-icon">‚úì</div>
                            </div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="facturas-pendientes">0</div>
                                    <div class="stat-label">Facturas Pendientes</div>
                                </div>
                                <div class="stat-icon">‚è≥</div>
                            </div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="clientes-activos">0</div>
                                    <div class="stat-label">Clientes Activos</div>
                                </div>
                                <div class="stat-icon">üë•</div>
                            </div>
                        </div>
                    </div>
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Ventas Mensuales 2024</h3>
                            </div>
                            <canvas id="salesChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Estado Facturas</h3>
                            </div>
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="table-card">
                        <div class="table-header">
                            <h3 class="table-title">Facturas Recientes</h3>
                            <div class="table-filters">
                                <button class="filter-btn active" onclick="filterInvoices('all')">Todas</button>
                                <button class="filter-btn" onclick="filterInvoices('paid')">Pagadas</button>
                                <button class="filter-btn" onclick="filterInvoices('pending')">Pendientes</button>
                                <button class="filter-btn" onclick="filterInvoices('overdue')">Vencidas</button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>N¬∫ Factura</th>
                                    <th>Cliente</th>
                                    <th>Fecha</th>
                                    <th>Monto</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="invoices-table-body"></tbody>
                        </table>
                    </div>
                `;
            } else if (page === 'invoices') {
                html = `
                    <div class="table-card">
                        <div class="table-header">
                            <h3 class="table-title">Todas las Facturas</h3>
                            <div class="table-filters">
                                <button class="filter-btn active" onclick="filterInvoices('all')">Todas</button>
                                <button class="filter-btn" onclick="filterInvoices('paid')">Pagadas</button>
                                <button class="filter-btn" onclick="filterInvoices('pending')">Pendientes</button>
                                <button class="filter-btn" onclick="filterInvoices('overdue')">Vencidas</button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>N¬∫ Factura</th>
                                    <th>Cliente</th>
                                    <th>Fecha</th>
                                    <th>Monto</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="invoices-table-body"></tbody>
                        </table>
                    </div>
                `;
            } else if (page === 'clients') {
                if (currentUser && currentUser.role === 'admin') {
                    html = `
                        <div class="table-card">
                            <div class="table-header">
                                <h3 class="table-title">Lista de Clientes</h3>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Tel√©fono</th>
                                        <th>Facturas Emitidas</th>
                                        <th>Total Facturado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="clients-table-body">
                                    <tr>
                                        <td><strong>Empresa ABC S.A.</strong></td>
                                        <td>contacto@abc.com</td>
                                        <td>3001234567</td>
                                        <td>12</td>
                                        <td><strong>$18.500</strong></td>
                                        <td><div class="action-btns"><button class="btn-action btn-view">üëÅÔ∏è</button><button class="btn-action btn-edit">‚úèÔ∏è</button></div></td>
                                    </tr>
                                    <!-- M√°s clientes simulados -->
                                </tbody>
                            </table>
                        </div>
                    `;
                } else {
                    html = `<div style="text-align:center;padding:120px;color:var(--danger);font-size:1.8em;">üö´ Acceso denegado - Solo administradores</div>`;
                }
            } else if (page === 'reports') {
                html = `
                    <div class="chart-card" style="margin-bottom:30px;">
                        <div class="chart-header">
                            <h3 class="chart-title">Resumen de Ingresos por Estado</h3>
                        </div>
                        <canvas id="reportChart" height="200"></canvas>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card success">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="report-paid">$0</div>
                                    <div class="stat-label">Total Pagado</div>
                                </div>
                                <div class="stat-icon">üí∞</div>
                            </div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="report-pending">$0</div>
                                    <div class="stat-label">Pendiente de Cobro</div>
                                </div>
                                <div class="stat-icon">‚è≥</div>
                            </div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="report-overdue">$0</div>
                                    <div class="stat-label">Vencidas</div>
                                </div>
                                <div class="stat-icon">‚ö†Ô∏è</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="report-total">$0</div>
                                    <div class="stat-label">Ingresos Totales</div>
                                </div>
                                <div class="stat-icon">üìä</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (page === 'settings') {
                html = `
                    <div class="table-card">
                        <div class="table-header">
                            <h3 class="table-title">Configuraci√≥n del Sistema</h3>
                        </div>
                        <div style="padding:30px;">
                            <div class="form-group">
                                <label>Nombre de la Empresa</label>
                                <input type="text" value="InvoiceFlow Corp">
                            </div>
                            <div class="form-group">
                                <label>Moneda Predeterminada</label>
                                <select><option>COP</option><option>USD</option><option>EUR</option></select>
                            </div>
                            <div class="form-group">
                                <label>Correo para Notificaciones</label>
                                <input type="email" value="admin@invoiceflow.com">
                            </div>
                            <div class="form-group">
                                <label>Impuesto por Defecto (%)</label>
                                <input type="number" value="19" step="0.1">
                            </div>
                            <div style="margin-top:30px;text-align:right;">
                                <button class="btn-primary" onclick="showToast('Configuraci√≥n guardada', 'success')">Guardar Cambios</button>
                            </div>
                        </div>
                    </div>
                `;
            }

            content.innerHTML = html;

            // Actualizar datos din√°micos
            if (page === 'dashboard') {
                updateStats();
                updateCharts();
                updateInvoicesTable();
            }
            if (page === 'invoices') {
                updateInvoicesTable();
            }
            if (page === 'reports') {
                updateReports();
            }

            showToast(`Secci√≥n: ${page.charAt(0).toUpperCase() + page.slice(1)}`, 'success');
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.toLowerCase();
            const password = document.getElementById('password').value;
            const selectedRole = document.querySelector('.role-btn.active').dataset.role;

            if (password !== '123456') {
                showToast('Contrase√±a incorrecta', 'error');
                return;
            }
            if (username !== selectedRole) {
                showToast('Usuario no coincide con el rol seleccionado', 'error');
                return;
            }

            showLoader();
            setTimeout(() => {
                currentUser = { username: username, role: selectedRole };
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('user-role-display').textContent = selectedRole.charAt(0).toUpperCase() + selectedRole.slice(1);
                if (selectedRole !== 'admin') {
                    document.querySelectorAll('.admin-only').forEach(item => item.style.display = 'none');
                }
                showPage('dashboard');
                hideLoader();
                showToast('¬°Bienvenido ' + username + '!', 'success');
            }, 1000);
        }

        function logout() {
            if (confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
                showLoader();
                setTimeout(() => {
                    currentUser = null;
                    document.getElementById('dashboard').classList.remove('active');
                    document.getElementById('login-page').style.display = 'flex';
                    document.getElementById('login-form').reset();
                    hideLoader();
                    showToast('Sesi√≥n cerrada correctamente', 'success');
                }, 500);
            }
        }

        function updateStats() {
            const currentMonth = new Date().getMonth();
            const monthInvoices = invoices.filter(inv => new Date(inv.date).getMonth() === currentMonth);
            const totalFacturado = monthInvoices.reduce((sum, inv) => sum + inv.amount, 0);
            const facturasPagadas = invoices.filter(inv => inv.status === 'paid').length;
            const facturasPendientes = invoices.filter(inv => inv.status === 'pending').length;
            const clientesActivos = new Set(invoices.map(inv => inv.client)).size;

            document.getElementById('total-facturado').textContent = '$' + totalFacturado.toLocaleString('es-CO', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('facturas-pagadas').textContent = facturasPagadas;
            document.getElementById('facturas-pendientes').textContent = facturasPendientes;
            document.getElementById('clientes-activos').textContent = clientesActivos;
        }

        function updateCharts() {
            const ctx1 = document.getElementById('salesChart');
            if (!ctx1) return;
            if (window.salesChartInstance) window.salesChartInstance.destroy();
            window.salesChartInstance = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    datasets: [{
                        label: 'Ventas',
                        data: [12000, 19000, 15000, 25000, 22000, 30000, 28000, 32000, 29000, 35000, 38000, 42000],
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => '$' + value.toLocaleString('es-CO')
                            }
                        }
                    }
                }
            });

            const ctx2 = document.getElementById('statusChart');
            if (!ctx2) return;
            if (window.statusChartInstance) window.statusChartInstance.destroy();
            const statusCounts = {
                paid: invoices.filter(i => i.status === 'paid').length,
                pending: invoices.filter(i => i.status === 'pending').length,
                overdue: invoices.filter(i => i.status === 'overdue').length
            };
            window.statusChartInstance = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Pagadas', 'Pendientes', 'Vencidas'],
                    datasets: [{
                        data: [statusCounts.paid, statusCounts.pending, statusCounts.overdue],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }        function updateInvoicesTable() {
            const tbody = document.getElementById('invoices-table-body');
            if (!tbody) return;

            let displayInvoices = invoices;
            if (currentFilter !== 'all') {
                displayInvoices = invoices.filter(inv => inv.status === currentFilter);
            }
            if (currentUser && currentUser.role === 'cliente') {
                displayInvoices = displayInvoices.slice(0, 2);
            }

            tbody.innerHTML = displayInvoices.map(invoice => `
                <tr>
                    <td><strong>${invoice.id}</strong></td>
                    <td>${invoice.client}</td>
                    <td>${new Date(invoice.date).toLocaleDateString('es-CO')}</td>
                    <td><strong>$ ${invoice.amount.toLocaleString('es-CO', {minimumFractionDigits: 2})}</strong></td>
                    <td>
                        <span class="status-badge status-${invoice.status}">
                            ${invoice.status === 'paid' ? 'Pagada' : invoice.status === 'pending' ? 'Pendiente' : 'Vencida'}
                        </span>
                    </td>
                    <td>
                        <div class="action-btns">
                            <button class="btn-action btn-view" onclick="viewInvoice('${invoice.id}')" title="Ver">üëÅÔ∏è</button>
                            ${currentUser && currentUser.role !== 'cliente' ? `
                                <button class="btn-action btn-edit" onclick="editInvoice('${invoice.id}')" title="Editar">‚úèÔ∏è</button>
                                <button class="btn-action btn-delete" onclick="deleteInvoice('${invoice.id}')" title="Eliminar">üóëÔ∏è</button>
                            ` : ''}
                            <button class="btn-action btn-view" onclick="downloadInvoice('${invoice.id}')" title="Descargar PDF">üì•</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function filterInvoices(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateInvoicesTable();
        }

        function openNewInvoiceModal() {
            if (currentUser && currentUser.role === 'cliente') {
                showToast('Los clientes no pueden crear facturas', 'error');
                return;
            }
            document.getElementById('invoice-form').reset();
            document.getElementById('invoice-date').valueAsDate = new Date();
            document.querySelector('#invoice-modal .modal-title').textContent = 'Nueva Factura';
            document.querySelector('#invoice-form button[type="submit"]').textContent = 'Crear Factura';
            document.getElementById('invoice-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('invoice-modal').classList.remove('active');
        }

        function handleNewInvoice(e) {
            e.preventDefault();
            showLoader();
            setTimeout(() => {
                const newInvoice = {
                    id: 'INV-' + String(invoices.length + 1).padStart(3, '0'),
                    client: document.getElementById('invoice-client').value.trim(),
                    date: document.getElementById('invoice-date').value,
                    amount: parseFloat(document.getElementById('invoice-amount').value),
                    status: document.getElementById('invoice-status').value,
                    description: document.getElementById('invoice-description').value.trim()
                };
                if (!newInvoice.client || isNaN(newInvoice.amount) || !newInvoice.date) {
                    showToast('Complete todos los campos obligatorios', 'error');
                    hideLoader();
                    return;
                }
                invoices.unshift(newInvoice);
                updateInvoicesTable();
                updateStats();
                updateCharts();
                closeModal();
                hideLoader();
                showToast('¬°Factura creada exitosamente!', 'success');
            }, 800);
        }

        function viewInvoice(id) {
            const invoice = invoices.find(inv => inv.id === id);
            if (!invoice) return;

            const modalHtml = `
                <div class="modal active">
                    <div class="modal-content" style="max-width:700px;">
                        <div class="modal-header">
                            <h3 class="modal-title">Detalle de Factura ${invoice.id}</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                        </div>
                        <div class="modal-body" style="line-height:1.8;">
                            <div style="background:var(--light);padding:25px;border-radius:12px;margin-bottom:25px;">
                                <p><strong>Cliente:</strong> ${invoice.client}</p>
                                <p><strong>Fecha:</strong> ${new Date(invoice.date).toLocaleDateString('es-CO')}</p>
                                <p><strong>Monto:</strong> <span style="font-size:1.8em;color:var(--primary);font-weight:700;">$${invoice.amount.toLocaleString('es-CO', {minimumFractionDigits: 2})}</span></p>
                                <p><strong>Estado:</strong> 
                                    <span class="status-badge status-${invoice.status}">
                                        ${invoice.status === 'paid' ? 'Pagada' : invoice.status === 'pending' ? 'Pendiente' : 'Vencida'}
                                    </span>
                                </p>
                            </div>
                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <div style="padding:15px;background:var(--light);border-radius:10px;min-height:80px;border:2px solid var(--border);">
                                    ${invoice.description || '<em>Sin descripci√≥n</em>'}
                                </div>
                            </div>
                            <div style="text-align:right;margin-top:30px;">
                                <button class="btn-primary" onclick="downloadInvoice('${invoice.id}')">Descargar PDF</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function editInvoice(id) {
            const invoice = invoices.find(inv => inv.id === id);
            if (!invoice) return;
            if (currentUser.role === 'cliente') {
                showToast('No tienes permiso para editar facturas', 'error');
                return;
            }

            // Abrir modal y precargar datos
            openNewInvoiceModal();
            document.getElementById('invoice-client').value = invoice.client;
            document.getElementById('invoice-date').value = invoice.date;
            document.getElementById('invoice-amount').value = invoice.amount;
            document.getElementById('invoice-status').value = invoice.status;
            document.getElementById('invoice-description').value = invoice.description || '';

            // Cambiar t√≠tulo y bot√≥n
            document.querySelector('#invoice-modal .modal-title').textContent = `Editar Factura ${id}`;
            const submitBtn = document.querySelector('#invoice-form button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Guardar Cambios';

            // Guardar referencia al handler original
            const originalSubmit = document.getElementById('invoice-form').onsubmit;

            // Sobrescribir temporalmente para edici√≥n
            document.getElementById('invoice-form').onsubmit = function(e) {
                e.preventDefault();

                const newAmount = parseFloat(document.getElementById('invoice-amount').value);
                const newClient = document.getElementById('invoice-client').value.trim();
                const newDate = document.getElementById('invoice-date').value;

                if (!newClient || isNaN(newAmount) || !newDate) {
                    showToast('Complete todos los campos obligatorios', 'error');
                    hideLoader();
                    return;
                }

                showLoader();
                setTimeout(() => {
                    // Actualizar la factura
                    invoice.client = newClient;
                    invoice.date = newDate;
                    invoice.amount = newAmount;
                    invoice.status = document.getElementById('invoice-status').value;
                    invoice.description = document.getElementById('invoice-description').value.trim();

                    // Actualizar vistas
                    updateInvoicesTable();
                    updateStats();
                    updateCharts();

                    // Cerrar y restaurar todo
                    closeModal();
                    hideLoader();
                    showToast('¬°Factura actualizada correctamente!', 'success');

                    // Restaurar formulario original
                    document.getElementById('invoice-form').onsubmit = originalSubmit;
                    document.querySelector('#invoice-modal .modal-title').textContent = 'Nueva Factura';
                    submitBtn.textContent = originalText;
                }, 800);
            };
        }

        function deleteInvoice(id) {
            if (confirm(`¬øSeguro que deseas eliminar la factura ${id}?`)) {
                showLoader();
                setTimeout(() => {
                    invoices = invoices.filter(inv => inv.id !== id);
                    updateInvoicesTable();
                    updateStats();
                    updateCharts();
                    hideLoader();
                    showToast('Factura eliminada', 'success');
                }, 500);
            }
        }

        function downloadInvoice(id) {
            const invoice = invoices.find(inv => inv.id === id);
            if (!invoice) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(22);
            doc.text('INVOICEFLOW', 105, 20, { align: 'center' });
            doc.setFontSize(18);
            doc.text(`Factura ${invoice.id}`, 105, 30, { align: 'center' });

            doc.setLineWidth(0.5);
            doc.line(20, 40, 190, 40);

            doc.setFontSize(12);
            doc.text(`Cliente: ${invoice.client}`, 20, 55);
            doc.text(`Fecha: ${new Date(invoice.date).toLocaleDateString('es-CO')}`, 20, 65);
            doc.text(`Estado: ${invoice.status === 'paid' ? 'Pagada' : invoice.status === 'pending' ? 'Pendiente' : 'Vencida'}`, 20, 75);

            doc.setFontSize(16);
            doc.text(`Monto Total: $${invoice.amount.toLocaleString('es-CO', {minimumFractionDigits: 2})}`, 20, 95);

            if (invoice.description) {
                doc.setFontSize(12);
                doc.text('Descripci√≥n:', 20, 115);
                const splitDesc = doc.splitTextToSize(invoice.description, 170);
                doc.text(splitDesc, 20, 125);
            }

            doc.setFontSize(10);
            doc.text('Gracias por su preferencia - InvoiceFlow', 105, 280, { align: 'center' });

            doc.save(`Factura_${invoice.id}.pdf`);
            showToast(`PDF de ${invoice.id} descargado correctamente`, 'success');
        }

        function handleSearch(e) {
            const query = e.target.value.trim().toLowerCase();
            const rows = document.querySelectorAll('#invoices-table-body tr');
            if (!query) {
                rows.forEach(row => row.style.display = '');
                return;
            }

            let found = 0;
            rows.forEach(row => {
                const invoiceId = row.querySelector('td strong').textContent;
                const invoice = invoices.find(inv => inv.id === invoiceId);
                if (!invoice) return;

                let match = false;

                if (query.includes(':')) {
                    const [field, value] = query.split(':');
                    if (field === 'cliente' && invoice.client.toLowerCase().includes(value.trim())) match = true;
                    if (field === 'estado' && invoice.status.toLowerCase().includes(value.trim())) match = true;
                    if (field === 'monto') {
                        const numQuery = value.trim();
                        const num = parseFloat(numQuery.replace('>', '').replace('<', ''));
                        if (numQuery.startsWith('>') && invoice.amount > num) match = true;
                        if (numQuery.startsWith('<') && invoice.amount < num) match = true;
                        if (!numQuery.match(/[<>]/) && invoice.amount == num) match = true;
                    }
                    if (field === 'fecha' && invoice.date.includes(value.trim())) match = true;
                } else {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(query)) match = true;
                }

                row.style.display = match ? '' : 'none';
                if (match) found++;
            });

            if (found === 0) {
                showToast(`No hay resultados para "${e.target.value}"`, 'error');
            }
        }

        function updateReports() {
            const paid = invoices.filter(i => i.status === 'paid').reduce((s, i) => s + i.amount, 0);
            const pending = invoices.filter(i => i.status === 'pending').reduce((s, i) => s + i.amount, 0);
            const overdue = invoices.filter(i => i.status === 'overdue').reduce((s, i) => s + i.amount, 0);
            const total = paid + pending + overdue;

            if (document.getElementById('report-paid')) document.getElementById('report-paid').textContent = '$' + paid.toLocaleString('es-CO', {minimumFractionDigits: 2});
            if (document.getElementById('report-pending')) document.getElementById('report-pending').textContent = '$' + pending.toLocaleString('es-CO', {minimumFractionDigits: 2});
            if (document.getElementById('report-overdue')) document.getElementById('report-overdue').textContent = '$' + overdue.toLocaleString('es-CO', {minimumFractionDigits: 2});
            if (document.getElementById('report-total')) document.getElementById('report-total').textContent = '$' + total.toLocaleString('es-CO', {minimumFractionDigits: 2});

            const ctx = document.getElementById('reportChart');
            if (!ctx) return;
            if (window.reportChart) window.reportChart.destroy();
            window.reportChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Pagadas', 'Pendientes', 'Vencidas'],
                    datasets: [{
                        data: [paid, pending, overdue],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
            });
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            showToast(`Modo ${isDark ? 'oscuro' : 'claro'} activado`, 'success');
        }

        function showNotifications() {
            showToast('Tienes 3 notificaciones pendientes', 'success');
        }

        function showLoader() {
            document.getElementById('loader').classList.add('active');
        }

        function hideLoader() {
            document.getElementById('loader').classList.remove('active');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.className = 'toast ' + type;
            toast.querySelector('.toast-message').textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>